%% For double-blind review submission
\documentclass[acmlarge,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission
%\documentclass[acmlarge,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission
%\documentclass[acmlarge]{acmart}\settopmatter{}

%% Some recommended packages.
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption
% Haskell code snippets
\usepackage{minted}
\newcommand{\hs}{\mintinline{haskell}}
\newcommand{\teq}{\smaller $\sim$}

\makeatletter\if@ACM@journal\makeatother
%% Journal information (used by PACMPL format)
%% Supplied to authors by publisher for camera-ready submission
\acmJournal{PACMPL}
\acmVolume{1}
\acmNumber{1}
\acmArticle{1}
\acmYear{2017}
\acmMonth{1}
\acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}
\else\makeatother
%% Conference information (used by SIGPLAN proceedings format)
%% Supplied to authors by publisher for camera-ready submission
\acmConference[PL'17]{ACM SIGPLAN Conference on Programming Languages}{January 01--03, 2017}{New York, NY, USA}
\acmYear{2017}
\acmISBN{978-x-xxxx-xxxx-x/YY/MM}
\acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}
\fi


%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission
\setcopyright{none}             %% For review submission
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2017}           %% If different from \acmYear

\bibliographystyle{ACM-Reference-Format}
\citestyle{acmauthoryear}   %% For author/year citations

\begin{document}

\title{Algebraic Graphs with Class}
                                        %% [Short Title] is optional;
                                        %% when present, will be used in
                                        %% header instead of Full Title.
%\titlenote{with title note}
                                        %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
%\subtitle{}
                                        %% \subtitle is optional
%\subtitlenote{with subtitle note}      %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'

%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{First1 Last1}
\authornote{with author1 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Position1}
  \department{Department1}              %% \department is recommended
  \institution{Institution1}            %% \institution is required
  \streetaddress{Street1 Address1}
  \city{City1}
  \state{State1}
  \postcode{Post-Code1}
  \country{Country1}
}
\email{first1.last1@inst1.edu}          %% \email is recommended

%% Paper note
%% The \thanks command may be used to create a "paper note" ---
%% similar to a title note or an author note, but not explicitly
%% associated with a particular element.  It will appear immediately
%% above the permission/copyright statement.
%\thanks{with paper note}               %% \thanks is optional
                                        %% can be repeated if necesary
                                        %% contents suppressed with 'anonymous'


%% Abstract
%% Note: \begin{abstract}...\end{abstract} environment must come
%% before \maketitle command
\begin{abstract}
The paper presents a minimalistic, elegant and powerful approach to working
with graphs in a functional programming language. The approach is built on
a rigorous mathematical foundation --- an algebra of graphs --- that allows
to apply equational reasoning for proving the correctness of graph transformation
algorithms. One useful feature of the presented approach compared to the
state-of-the-art graph libraries is that it allows to avoid partial functions on
graphs, typically required for handling `malformed graphs' that contain an
edge referring to a non-existent vertex. Algebraic graphs make it impossible to
specify such malformed graphs, thereby eliminating the need for partial functions.

The basic definition of algebraic graphs corresponds to unlabelled directed graphs.
We show that by extending the algebra with additional axioms, it is possible to also
represent undirected, reflexive, transitively closed, and labelled graphs.
We present a library of graph construction and transformation primitives that are
polymorphic and can therefore be reused by all graph implementations, and
demonstrate the flexibility of algebraic graphs by a few examples.
\end{abstract}

%% 2012 ACM Computing Classification System (CSS) concepts
%% Generate at 'http://dl.acm.org/ccs/ccs.cfm'.
\begin{CCSXML}
<ccs2012>
<concept>
<concept_id>10002950.10003624.10003633</concept_id>
<concept_desc>Mathematics of computing~Graph theory</concept_desc>
<concept_significance>500</concept_significance>
</concept>
<concept>
<concept_id>10003752.10010124.10010125.10010127</concept_id>
<concept_desc>Theory of computation~Functional constructs</concept_desc>
<concept_significance>500</concept_significance>
</concept>
</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Mathematics of computing~Graph theory}
\ccsdesc[500]{Theory of computation~Functional constructs}%% End of generated code

\keywords{algebra, graph theory, polymorphism, functional programming}

%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle

\section{Introduction}

Graphs are ubiquitous in computing, yet working with graphs often requires
painfully low-level fiddling with sets of vertices and edges. As a motivating
example, we look at two popular Haskell graph libraries\footnote{In this paper
we exclusively use Haskell, but the presented approach can be adapted to
other functional programming languages.}. The first one is available from the
\textsf{containers} package and uses adjacency arrays to represent graphs,
as described by King and Launchbury~\citeyear{1995_king_graphs}. The second one
is the \textsf{fgl} library, which is based on \emph{inductive graphs}
by Martin Erwig~\citeyear{2001_erwig_inductive}. Both libraries are
actively maintained\footnote{As of writing, the latest versions of the libraries
are \textsf{containers-0.5.10.1} and \textsf{fgl-5.5.3.0}.},
have many users, and provide efficient implementations of
fundamental graph algorithms. We argue, however, that using these libraries
can be difficult and error-prone, and show how to access their algorithmic power
via a simple and safe interface based on \emph{algebraic graphs}.

Fig.~\ref{fig-example} compares the \textsf{containers} and
\textsf{fgl} libraries with algebraic graphs on a sequence of
simple graph transformations: we start with graph $a$ containing the
edge $1 \rightarrow 2$; graph $b$ is obtained by adding the vertex $3$
and the edge $3 \rightarrow 1$ to $a$; finally, graph $c$ is obtained by removing
the vertex $2$ from graph $b$.

% As we show in \S\ref{sec-class}, these graphs can be
% described by the following algebraic expressions: $a = 1 \rightarrow 2$,
% $b = 1 \rightarrow 2 + 3 \rightarrow 1$ and $c = 3 \rightarrow 1$.

Fig.~\ref{fig-example}(a) shows how to realise these graph transformations
using the \textsf{containers} library. To construct graph~$a$ one needs
to specify both the set of vertices and edges. Note that
\hs{buildG} is \emph{partial} and will fail if these sets are inconsistent.
As an example, \hs{buildG (2,2) [(1,2)]} is well-typed but fails with the
\textsf{`index out of range'} error, since the edge refers to the non-existent vertex 1.
To construct $b$, we extend the vertex set and append the
edge $3 \rightarrow 1$ to the list of edges of $a$; the \textsf{containers} library does
not support sharing of common subgraphs and new memory is allocated for
storing the whole graph $b$. Furthermore, the library is
\emph{incomplete}: the graphs whose vertex sets are not contiguous subsets of
integers cannot be represented. Graph $c$ is an example: its vertex set is
$\{1,3\}$ and the best we can do is to remove all edges adjacent to vertex 2
leaving it isolated in the resulting graph.

The \textsf{fgl} library defines the type class \hs{Graph} and its subclass
\hs{DynGraph} for working with static (unchangeable) and dynamic (changeable)
graphs, comprising 10 class methods in total. As shown in Fig.~\ref{fig-example}(b),
to create graph~$a$ we call the \hs{mkUGraph} method, which is similar to
\hs{buildG} from the \textsf{containers} library and also needs to deal with the
awkward case when the sets of vertices and edges are inconsistent; instead of
failing with an error, \textsf{fgl} chooses to ignore edges adjacent to non-existent
vertices, hence \hs{mkUGraph [] [(1,2)]} creates the empty graph. To construct
graph~$b$, we first add the vertex 3 to $a$ and then add the edge $3 \rightarrow 1$.
If we skip the first step, \hs{insEdge} fails with the
\textsf{`edge from non-existent vertex'} error.
Note that \textsf{fgl} is optimised for working with labelled graphs, which requires
using the dummy label \hs{()} for vertices and edges when working with unlabelled
graphs. Graph~$c$ is obtained in a straightforward way by calling the \hs{delNode}
function. As one can see, the resulting expression is still polymorphic, admitting
multiple possible implementations. The default implementation of the \hs{DynGraph}
class supports subgraph sharing, thus being more memory efficient compared to
the \textsf{containers} library.

\begin{figure}
\begin{subfigure}[b]{0.28\linewidth}
\begin{minted}[fontsize=\small]{haskell}
import Data.Graph

-- Create graph 1 --> 2
a :: Graph
a = buildG (1,2) [(1,2)]

-- Add edge 3 --> 1 to a
b :: Graph
b = buildG (1,3) $
    edges a ++ [(3,1)]

-- Remove vertex 2 from b
c :: Graph
c = buildG (1,3) $ filter
    (not . adj 2) (edges b)
\end{minted}
\caption{\textsf{containers} library}
\end{subfigure}
\hfill
\vrule
\hfill
\hfill
\hfill
\begin{subfigure}[b]{0.3\linewidth}
\begin{minted}[fontsize=\small,escapeinside=@@]{haskell}
import Data.Graph.Inductive

-- Create graph 1 --> 2
a :: Graph gr => gr () ()
a = mkUGraph [1,2] [(1,2)]

-- Add edge 3 --> 1 to a
b :: DynGraph gr => gr () ()
b = insEdge (3,1,()) $
    insNode (3,()) a

-- Remove vertex 2 from b
c :: DynGraph gr => gr () ()
c = delNode 2 b
@ @
\end{minted}
\caption{\textsf{fgl} library}
\end{subfigure}
\hfill
\vrule
\hfill
\hfill
\begin{subfigure}[b]{0.35\linewidth}
\begin{minted}[fontsize=\small,escapeinside=@@]{haskell}
import Algebra.Graph

-- Create graph 1 --> 2
a :: (Graph g, Vertex g @\teq@ Int) => g
a = connect (vertex 1) (vertex 2)

-- Add edge 3 --> 1 to a
b :: (Graph g, Vertex g @\teq@ Int) => g
b = overlay a $
    connect (vertex 3) (vertex 1)

-- Remove vertex 2 from b
c :: (Graph g, Vertex g @\teq@ Int) => g
c = removeVertex 2 b
@ @
\end{minted}
\caption{Algebraic graphs}
\end{subfigure}
\caption{Simple transformations of unlabelled directed graphs\label{fig-example}}
\vspace{-4mm}
\end{figure}

Algebraic graphs are built on the minimalistic type class \hs{Graph} comprising
only four methods \hs{empty}, \hs{vertex}, \hs{overlay} and \hs{connect}. The code in
Fig.~\ref{fig-example}(c) intentionally avoids helper library functions (apart
from \hs{removeVertex}), performing the intended graph transformations using the
bare-metal primitives of the algebra. Graph~$a$ is constructed by \emph{connecting}
vertices 1 and 2. This definition has no hidden partiality or ambiguity.
Unlike the \textsf{containers} and \textsf{fgl} libraries, the type of vertices
is not fixed to \hs{Int}, e.g. we could have used \hs{Integer} instead.
Graph~$b$ is constructed by \emph{overlaying} $a$ with the edge $3 \rightarrow 1$.
To remove the vertex 2 in $c$ we use the polymorphic library function
\hs{removeVertex} that essentially replaces the vertex with the \hs{empty} graph,
as explained in \S\ref{sec-transformations}.
We argue that the algebraic interface is superior, because it
abstracts away such details as sets of vertices and edges.

The main idea of this paper is that the proposed minimalistic core of four graph
construction primitives provides a safe and flexible algebraic interface
for working with graphs, and also unlocks a new world of graph instances, with
classic inhabitants from \textsf{containers} and \textsf{fgl}, as well
as new, unknown forms of life.

Our main contributions are:
\begin{itemize}
    \item We define algebraic graphs in \S\ref{sec-class} and analyse the resulting
    mathematical structure in \S\ref{sec-algebra}.
    \item \S\ref{sec-a-la-carte} extends the algebra for representing
    undirected, reflexive, transitively closed and labelled graphs.
    \item A library of basic graph construction and transformation primitives
    is developed in \S\ref{sec-transformations}.
    \item We demonstrate the flexibility of algebraic graphs by a few examples
    in \S\ref{sec-applications}.
\end{itemize}

We review related work in \S\ref{sec-related} and outline future research
directions in \S\ref{sec-discussion}.

% Focus not on graph algorithms, but more on convenient graph
% specification/transformation language.

% "Unlike traditional approaches
% based on mutable references or node/edge lists, well-formedness of
% the graph structure is ensured statically and reasoning can be done
% with standard functional programming techniques."


\section{The class of algebraic graphs}\label{sec-class}

\section{Algebraic structure}\label{sec-algebra}

\section{Graphs a la carte}\label{sec-a-la-carte}

\section{Graph transformation library}\label{sec-transformations}

\section{Applications}\label{sec-applications}

\section{Related work}\label{sec-related}

% In this section we review existing approaches to working with graphs developed
% by the functional programming community.

% \begin{itemize}
%     \item Tying the knot:
%     \item Borrowing imperative algorithms via the State monad.
%     \item Data.Graph by King & Launchbury, 1995. \url{https://galois.com/wp-content/uploads/2014/08/pub_JL_StructuringDFSAlgorithms.pdf}.
%     Clever tricks exploiting lazy evaluation (Johnsson 1998) \url{https://pdfs.semanticscholar.org/a6ed/4e55f148e0c48445269990102838f7d7abb5.pdf?_ga=1.176470501.1134931652.1487554701}

%     \item Inductive Graphs by Martin Erwig, 2001. \url{https://web.engr.oregonstate.edu/~erwig/papers/InductiveGraphs_JFP01.pdf}
%     \item Structured Graphs by Oliveira & Cook. \url{https://www.cs.utexas.edu/~wcook/Drafts/2012/graphs.pdf}
%     \item An initial-algebra approach to directed acyclic graphs, by J. Gibbons
%     \item "Algebras for graphs have been studied in the context of graph rewriting, see Bauderon and Courcelle (1986), for example."
% \end{itemize}

\section{Discussion and future work}\label{sec-discussion}


%% Acknowledgments
\begin{acks}                            %% acks environment is optional
                                        %% contents suppressed with 'anonymous'
  %% Commands \grantsponsor{<sponsorID>}{<name>}{<url>} and
  %% \grantnum[<url>]{<sponsorID>}{<number>} should be used to
  %% acknowledge financial support and will be used by metadata
  %% extraction tools.
  This material is based upon work supported by the
  \grantsponsor{GS100000001}{National Science
    Foundation}{http://dx.doi.org/10.13039/100000001} under Grant
  No.~\grantnum{GS100000001}{nnnnnnn} and Grant
  No.~\grantnum{GS100000001}{mmmmmmm}.  Any opinions, findings, and
  conclusions or recommendations expressed in this material are those
  of the author and do not necessarily reflect the views of the
  National Science Foundation.
\end{acks}

\bibliography{publications}

% \appendix
% \section{Appendix}

% Text of appendix \ldots

\end{document}
